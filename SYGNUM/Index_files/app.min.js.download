!function(t){function e(t){if(t){if("string"==typeof o[t])return t;t=t.charAt(0).toUpperCase()+t.slice(1);for(var e,n=0,r=i.length;n<r;n++)if(e=i[n]+t,"string"==typeof o[e])return e}}var i=["Webkit","Moz","ms","Ms","O"],o=document.documentElement.style;"function"==typeof define&&define.amd?define(function(){return e}):t.getStyleProperty=e}(window),function(t,e){function i(t){var e=parseFloat(t);return-1===t.indexOf("%")&&!isNaN(e)&&e}function o(t){var e,o=t("boxSizing");return function(){if(o){var t=document.createElement("div");t.style.width="200px",t.style.padding="1px 2px 3px 4px",t.style.borderStyle="solid",t.style.borderWidth="1px 2px 3px 4px",t.style[o]="border-box";var n=document.body||document.documentElement;n.appendChild(t);var s=r(t);e=200===i(s.width),n.removeChild(t)}}(),function(t){if("string"==typeof t&&(t=document.querySelector(t)),t&&"object"==typeof t&&t.nodeType){var n=r(t);if("none"===n.display){var a={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0},n=0;for(t=s.length;n<t;n++)a[s[n]]=0;return a}a={},a.width=t.offsetWidth,a.height=t.offsetHeight,t=a.isBorderBox=!(!o||!n[o]||"border-box"!==n[o]);for(var h=0,l=s.length;h<l;h++){var p=s[h],d=parseFloat(n[p]);a[p]=isNaN(d)?0:d}var h=a.paddingLeft+a.paddingRight,l=a.paddingTop+a.paddingBottom,p=a.marginLeft+a.marginRight,d=a.marginTop+a.marginBottom,c=a.borderLeftWidth+a.borderRightWidth,u=a.borderTopWidth+a.borderBottomWidth;t=t&&e;var f=i(n.width);return!1!==f&&(a.width=f+(t?0:h+c)),n=i(n.height),!1!==n&&(a.height=n+(t?0:l+u)),a.innerWidth=a.width-(h+c),a.innerHeight=a.height-(l+u),a.outerWidth=a.width+p,a.outerHeight=a.height+d,a}}}var n=document.defaultView,r=n&&n.getComputedStyle?function(t){return n.getComputedStyle(t,null)||t.style||{}}:function(t){return t.currentStyle},s="paddingLeft paddingRight paddingTop paddingBottom marginLeft marginRight marginTop marginBottom borderLeftWidth borderRightWidth borderTopWidth borderBottomWidth".split(" ");"function"==typeof define&&define.amd?define(["get-style-property/get-style-property"],o):t.getSize=o(t.getStyleProperty)}(window),function(t,e){function i(t,e){return t[s](e)}function o(t,e){t.parentNode||document.createDocumentFragment().appendChild(t);for(var i=t.parentNode.querySelectorAll(e),o=0,n=i.length;o<n;o++)if(i[o]===t)return!0;return!1}function n(t,e){return t.parentNode||document.createDocumentFragment().appendChild(t),i(t,e)}var r,s=function(){if(e.matchesSelector)return"matchesSelector";for(var t=["webkit","moz","ms","o"],i=0,o=t.length;i<o;i++){var n=t[i]+"MatchesSelector";if(e[n])return n}}();if(s){var a=document.createElement("div");r=i(a,"div")?i:n}else r=o;"function"==typeof define&&define.amd?define(function(){return r}):window.matchesSelector=r}(0,Element.prototype),function(){function t(){}function e(t,e){for(var i=t.length;i--;)if(t[i].listener===e)return i;return-1}var i=t.prototype;i.getListeners=function(t){var e,i,o=this._getEvents();if("object"==typeof t)for(i in e={},o)o.hasOwnProperty(i)&&t.test(i)&&(e[i]=o[i]);else e=o[t]||(o[t]=[]);return e},i.flattenListeners=function(t){var e,i=[];for(e=0;e<t.length;e+=1)i.push(t[e].listener);return i},i.getListenersAsObject=function(t){var e,i=this.getListeners(t);return i instanceof Array&&(e={},e[t]=i),e||i},i.addListener=function(t,i){var o,n=this.getListenersAsObject(t),r="object"==typeof i;for(o in n)n.hasOwnProperty(o)&&-1===e(n[o],i)&&n[o].push(r?i:{listener:i,once:!1});return this},i.on=i.addListener,i.addOnceListener=function(t,e){return this.addListener(t,{listener:e,once:!0})},i.once=i.addOnceListener,i.defineEvent=function(t){return this.getListeners(t),this},i.defineEvents=function(t){for(var e=0;e<t.length;e+=1)this.defineEvent(t[e]);return this},i.removeListener=function(t,i){var o,n,r=this.getListenersAsObject(t);for(n in r)r.hasOwnProperty(n)&&-1!==(o=e(r[n],i))&&r[n].splice(o,1);return this},i.off=i.removeListener,i.addListeners=function(t,e){return this.manipulateListeners(!1,t,e)},i.removeListeners=function(t,e){return this.manipulateListeners(!0,t,e)},i.manipulateListeners=function(t,e,i){var o,n,r=t?this.removeListener:this.addListener;if(t=t?this.removeListeners:this.addListeners,"object"!=typeof e||e instanceof RegExp)for(o=i.length;o--;)r.call(this,e,i[o]);else for(o in e)e.hasOwnProperty(o)&&(n=e[o])&&("function"==typeof n?r.call(this,o,n):t.call(this,o,n));return this},i.removeEvent=function(t){var e,i=typeof t,o=this._getEvents();if("string"===i)delete o[t];else if("object"===i)for(e in o)o.hasOwnProperty(e)&&t.test(e)&&delete o[e];else delete this._events;return this},i.emitEvent=function(t,e){var i,o,n,r=this.getListenersAsObject(t);for(n in r)if(r.hasOwnProperty(n))for(o=r[n].length;o--;)i=r[n][o],i.listener.apply(this,e||[])!==this._getOnceReturnValue()&&!0!==i.once||this.removeListener(t,i.listener);return this},i.trigger=i.emitEvent,i.emit=function(t){var e=Array.prototype.slice.call(arguments,1);return this.emitEvent(t,e)},i.setOnceReturnValue=function(t){return this._onceReturnValue=t,this},i._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},i._getEvents=function(){return this._events||(this._events={})},"function"==typeof define&&define.amd?define(function(){return t}):"undefined"!=typeof module&&module.exports?module.exports=t:this.EventEmitter=t}.call(this),function(t){var e=document.documentElement,i=function(){};e.addEventListener?i=function(t,e,i){t.addEventListener(e,i,!1)}:e.attachEvent&&(i=function(e,i,o){e[i+o]=o.handleEvent?function(){var e=t.event;e.target=e.target||e.srcElement,o.handleEvent.call(o,e)}:function(){var i=t.event;i.target=i.target||i.srcElement,o.call(e,i)},e.attachEvent("on"+i,e[i+o])});var o=function(){};e.removeEventListener?o=function(t,e,i){t.removeEventListener(e,i,!1)}:e.detachEvent&&(o=function(t,e,i){t.detachEvent("on"+e,t[e+i]);try{delete t[e+i]}catch(o){t[e+i]=void 0}}),e={bind:i,unbind:o},"function"==typeof define&&define.amd?define(e):t.eventie=e}(this),function(t){function e(t){"function"==typeof t&&(e.isReady?t():r.push(t))}function i(t){if(t="readystatechange"===t.type&&"complete"!==n.readyState,!e.isReady&&!t){e.isReady=!0,t=0;for(var i=r.length;t<i;t++)(0,r[t])()}}function o(o){return o.bind(n,"DOMContentLoaded",i),o.bind(n,"readystatechange",i),o.bind(t,"load",i),e}var n=t.document,r=[];e.isReady=!1,"function"==typeof define&&define.amd?(e.isReady="function"==typeof requirejs,define(["eventie/eventie"],o)):t.docReady=o(t.eventie)}(this),function(t){function e(t,e){(i(t,e)?n:o)(t,e)}var i,o,n;"classList"in document.documentElement?(i=function(t,e){return t.classList.contains(e)},o=function(t,e){t.classList.add(e)},n=function(t,e){t.classList.remove(e)}):(i=function(t,e){return RegExp("(^|\\s+)"+e+"(\\s+|$)").test(t.className)},o=function(t,e){i(t,e)||(t.className=t.className+" "+e)},n=function(t,e){t.className=t.className.replace(RegExp("(^|\\s+)"+e+"(\\s+|$)")," ")});var r={hasClass:i,addClass:o,removeClass:n,toggleClass:e,has:i,add:o,remove:n,toggle:e};"function"==typeof define&&define.amd?define(r):t.classie=r}(window),function(t){function e(t){for(var i in e.defaults)this[i]=e.defaults[i];for(i in t)this[i]=t[i]}(t.Packery=function(){}).Rect=e,e.defaults={x:0,y:0,width:0,height:0},e.prototype.contains=function(t){var e=t.width||0,i=t.height||0;return this.x<=t.x&&this.y<=t.y&&this.x+this.width>=t.x+e&&this.y+this.height>=t.y+i},e.prototype.overlaps=function(t){var e=this.x+this.width,i=this.y+this.height,o=t.y+t.height;return this.x<t.x+t.width&&e>t.x&&this.y<o&&i>t.y},e.prototype.getMaximalFreeRects=function(t){if(!this.overlaps(t))return!1;var i,o=[],n=this.x+this.width,r=this.y+this.height,s=t.x+t.width,a=t.y+t.height;return this.y<t.y&&(i=new e({x:this.x,y:this.y,width:this.width,height:t.y-this.y}),o.push(i)),n>s&&(i=new e({x:s,y:this.y,width:n-s,height:this.height}),o.push(i)),r>a&&(i=new e({x:this.x,y:a,width:this.width,height:r-a}),o.push(i)),this.x<t.x&&(i=new e({x:this.x,y:this.y,width:t.x-this.x,height:this.height}),o.push(i)),o},e.prototype.canFit=function(t){return this.width>=t.width&&this.height>=t.height}}(window),function(t){function e(t,e){this.width=t||0,this.height=e||0,this.reset()}t=t.Packery;var i=t.Rect;e.prototype.reset=function(){this.spaces=[],this.newSpaces=[];var t=new i({x:0,y:0,width:this.width,height:this.height});this.spaces.push(t)},e.prototype.pack=function(t,e){for(var i=0,o=this.spaces.length;i<o;i++){var n=this.spaces[i];if(n.canFit(t)){this.placeInSpace(t,n,e);break}}},e.prototype.placeInSpace=function(t,e,i){t.x=e.x,t.y=e.y,this.placed(t,i)},e.prototype.placed=function(t,i){for(var o=[],n=0,r=this.spaces.length;n<r;n++){var s=this.spaces[n],a=s.getMaximalFreeRects(t);a?o.push.apply(o,a):o.push(s)}this.spaces=o,e.mergeRects(this.spaces),"horizontal"==i?this.spaces.sort(e.spaceSorterLeftTop):this.spaces.sort(e.spaceSorterTopLeft)},e.mergeRects=function(t){for(var e=0,i=t.length;e<i;e++){var o=t[e];if(o){var n=t.slice(0);n.splice(e,1);for(var r=0,s=0,a=n.length;s<a;s++){var h=e>s?0:1;o.contains(n[s])&&(t.splice(s+h-r,1),r++)}}}return t},e.spaceSorterTopLeft=function(t,e){return t.y-e.y||t.x-e.x},e.spaceSorterLeftTop=function(t,e){return t.x-e.x||t.y-e.y},t.Packer=e}(window),function(t){function e(t,e){this.element=t,this.packery=e,this.position={x:0,y:0},this.rect=new o,this.placeRect=new o,this.element.style.position="absolute"}var i=t.Packery,o=i.Rect,n=t.getSize,r=t.getStyleProperty;t=t.EventEmitter;var s=document.defaultView,a=s&&s.getComputedStyle?function(t){return s.getComputedStyle(t,null)||t.style||{}}:function(t){return t.currentStyle},h=r("transition"),l=r("transform"),p=h&&l,r=!!r("perspective"),d={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"otransitionend",transition:"transitionend"}[h],c={WebkitTransform:"-webkit-transform",MozTransform:"-moz-transform",OTransform:"-o-transform",transform:"transform"}[l];!function(t,e){for(var i in e)t[i]=e[i]}(e.prototype,t.prototype),e.prototype.handleEvent=function(t){var e="on"+t.type;this[e]&&this[e](t)},e.prototype.getSize=function(){this.size=n(this.element)},e.prototype.css=function(t){var e,i=this.element.style;for(e in t)i[e]=t[e]},e.prototype.getPosition=function(){var t=a(this.element),e=parseInt(t.left,10),t=parseInt(t.top,10),e=isNaN(e)?0:e,t=isNaN(t)?0:t,i=this.packery.elementSize,e=e-i.paddingLeft,t=t-i.paddingTop;this.position.x=e,this.position.y=t};var u=r?function(t,e){return"translate3d( "+t+"px, "+e+"px, 0)"}:function(t,e){return"translate( "+t+"px, "+e+"px)"};e.prototype._transitionTo=function(t,e){this.getPosition();var i=this.position.x,o=this.position.y,n=parseInt(t,10),r=parseInt(e,10),n=n===this.position.x&&r===this.position.y;this.setPosition(t,e),n&&!this.isTransitioning?this.layoutPosition():(n={},n[c]=u(t-i,e-o),this.transition(n,this.layoutPosition))},e.prototype.goTo=function(t,e){this.setPosition(t,e),this.layoutPosition()},e.prototype.moveTo=p?e.prototype._transitionTo:e.prototype.goTo,e.prototype.setPosition=function(t,e){this.position.x=parseInt(t,10),this.position.y=parseInt(e,10)},e.prototype.layoutPosition=function(){var t=this.packery.elementSize;this.css({left:this.position.x+t.paddingLeft+"px",top:this.position.y+t.paddingTop+"px"}),this.emitEvent("layout",[this])},e.prototype._nonTransition=function(t,e){this.css(t),e&&e.call(this)},e.prototype._transition=function(t,e){this.transitionStyle=t;var i,o=[];for(i in t)o.push(i);i={},i[h+"Property"]=o.join(","),i[h+"Duration"]=this.packery.options.transitionDuration,this.element.addEventListener(d,this,!1),e&&this.on("transitionEnd",function(t){return e.call(t),!0}),this.css(i),this.css(t),this.isTransitioning=!0},e.prototype.transition=e.prototype[h?"_transition":"_nonTransition"],e.prototype.onwebkitTransitionEnd=function(t){this.ontransitionend(t)},e.prototype.onotransitionend=function(t){this.ontransitionend(t)},e.prototype.ontransitionend=function(t){if(t.target===this.element){this.onTransitionEnd&&(this.onTransitionEnd(),delete this.onTransitionEnd),this.removeTransitionStyles(),t={};for(var e in this.transitionStyle)t[e]="";this.css(t),this.element.removeEventListener(d,this,!1),delete this.transitionStyle,this.isTransitioning=!1,this.emitEvent("transitionEnd",[this])}},e.prototype.removeTransitionStyles=function(){var t={};t[h+"Property"]="",t[h+"Duration"]="",this.css(t)},e.prototype.remove=function(){var t={opacity:0};t[c]="scale(0.001)",this.transition(t,this.removeElem)},e.prototype.removeElem=function(){this.element.parentNode.removeChild(this.element),this.emitEvent("remove",[this])},e.prototype.reveal=h?function(){var t={opacity:0};t[c]="scale(0.001)",this.css(t),t={opacity:1},t[c]="scale(1)",this.transition(t)}:function(){},e.prototype.destroy=function(){this.css({position:"",left:"",top:""})},e.prototype.dragStart=function(){this.getPosition(),this.removeTransitionStyles(),this.isTransitioning&&l&&(this.element.style[l]="none"),this.getSize(),this.isPlacing=!0,this.needsPositioning=!1,this.positionPlaceRect(this.position.x,this.position.y),this.didDrag=this.isTransitioning=!1},e.prototype.dragMove=function(t,e){this.didDrag=!0;var i=this.packery.elementSize;t-=i.paddingLeft,e-=i.paddingTop,this.positionPlaceRect(t,e)},e.prototype.dragStop=function(){this.getPosition();var t=this.position.y!==this.placeRect.y;this.needsPositioning=this.position.x!==this.placeRect.x||t,this.didDrag=!1},e.prototype.positionPlaceRect=function(t,e,i){this.placeRect.x=this.getPlaceRectCoord(t,!0),this.placeRect.y=this.getPlaceRectCoord(e,!1,i)},e.prototype.getPlaceRectCoord=function(t,e,i){var o=e?"Width":"Height",n=this.size["outer"+o],r=this.packery[e?"columnWidth":"rowHeight"],o=this.packery.elementSize["inner"+o];return e||(o=Math.max(o,this.packery.maxY),this.packery.rowHeight||(o-=this.packery.gutter)),r?(r+=this.packery.gutter,o+=e?this.packery.gutter:0,t=Math.round(t/r),e=Math[e?"floor":"ceil"](o/r),n=e-=Math.ceil(n/r)):n=o-n,t=i?t:Math.min(t,n),Math.max(0,t*(r||1))},e.prototype.copyPlaceRectPosition=function(){this.rect.x=this.placeRect.x,this.rect.y=this.placeRect.y},i.Item=e}(window),function(t){function e(t,e){for(var i in e)t[i]=e[i];return t}function i(t){var e=[];if("number"==typeof t.length)for(var i=0,o=t.length;i<o;i++)e.push(t[i]);else e.push(t);return e}function o(t,i){if(t&&m(t)){this.element=t,this.options=e({},this.options),e(this.options,i);var o=++y;this.element.packeryGUID=o,v[o]=this,this._create(),this.options.isInitLayout&&this.layout()}else u&&u.error("bad Packery element: "+t)}var n=t.Packery,r=n.Rect,s=n.Packer,a=n.Item,h=t.classie,n=t.docReady,l=t.eventie,p=t.getSize,d=t.matchesSelector,c=t.document,u=t.console,f=t.jQuery,m="object"==typeof HTMLElement?function(t){return t instanceof HTMLElement}:function(t){return t&&"object"==typeof t&&1===t.nodeType&&"string"==typeof t.nodeName},g=Array.prototype.indexOf?function(t,e){return t.indexOf(e)}:function(t,e){for(var i=0,o=t.length;i<o;i++)if(t[i]===e)return i;return-1},y=0,v={};e(o.prototype,t.EventEmitter.prototype),o.prototype.options={containerStyle:{position:"relative"},layoutMode:"horizontal",isInitLayout:!0,isResizeBound:!0,transitionDuration:"0.4s"},o.prototype._create=function(){this.packer=new s,this.reloadItems(),this.stampedElements=[],this.stamp(this.options.stamped),e(this.element.style,this.options.containerStyle),this.options.isResizeBound&&this.bindResize();var t=this;this.handleDraggabilly={dragStart:function(e){t.itemDragStart(e.element)},dragMove:function(e){t.itemDragMove(e.element,e.position.x,e.position.y)},dragEnd:function(e){t.itemDragEnd(e.element)}},this.handleUIDraggable={start:function(e){t.itemDragStart(e.currentTarget)},drag:function(e,i){t.itemDragMove(e.currentTarget,i.position.left,i.position.top)},stop:function(e){t.itemDragEnd(e.currentTarget)}}},o.prototype.reloadItems=function(){this.items=this._getItems(this.element.children)},o.prototype._getItems=function(t){t=this._filterFindItemElements(t);for(var e=[],i=0,o=t.length;i<o;i++){var n=new a(t[i],this);e.push(n)}return e},o.prototype._filterFindItemElements=function(t){t=i(t);var e=this.options.itemSelector;if(!e)return t;for(var o=[],n=0,r=t.length;n<r;n++){var s=t[n];d(s,e)&&o.push(s);for(var s=s.querySelectorAll(e),a=0,h=s.length;a<h;a++)o.push(s[a])}return o},o.prototype.getItemElements=function(){for(var t=[],e=0,i=this.items.length;e<i;e++)t.push(this.items[e].element);return t},o.prototype.layout=function(){this._prelayout(),this.layoutItems(this.items,void 0!==this.options.isLayoutInstant?this.options.isLayoutInstant:!this._isLayoutInited),this._isLayoutInited=!0},o.prototype._init=o.prototype.layout,o.prototype._prelayout=function(){this.elementSize=p(this.element),this._getMeasurements(),"horizontal"==this.options.layoutMode?(this.packer.width=Number.POSITIVE_INFINITY,this.packer.height=this.elementSize.innerHeight+this.gutter):(this.packer.width=this.elementSize.innerWidth+this.gutter,this.packer.height=Number.POSITIVE_INFINITY),this.packer.reset(),this.maxY=this.maxX=0,this.placeStampedElements()},o.prototype._getMeasurements=function(){this._getMeasurement("columnWidth","width"),this._getMeasurement("rowHeight","height"),this._getMeasurement("gutter","width")},o.prototype._getMeasurement=function(t,e){var i,o=this.options[t];o?("string"==typeof o?i=this.element.querySelector(o):m(o)&&(i=o),this[t]=i?p(i)[e]:o):this[t]=0},o.prototype.layoutItems=function(t,e){var i=this._getLayoutItems(t);if(i&&i.length){this._itemsOn(i,"layout",function(){this.emitEvent("layoutComplete",[this,i])});for(var o=0,n=i.length;o<n;o++){var r=i[o];this._packItem(r),this._layoutItem(r,e)}}else this.emitEvent("layoutComplete",[this,[]]);this._setContainerSize()},o.prototype._setContainerSize=function(){var t=this.elementSize;if("horizontal"==this.options.layoutMode){var e=this.maxX-this.gutter;t.isBorderBox&&(e+=t.paddingLeft+t.paddingRight+t.borderRightWidth+t.borderLeftWidth),e=Math.max(e,0),this.element.style.width=e+"px"}else e=this.maxY-this.gutter,t.isBorderBox&&(e+=t.paddingBottom+t.paddingTop+t.borderTopWidth+t.borderBottomWidth),e=Math.max(e,0),this.element.style.height=e+"px"},o.prototype._getLayoutItems=function(t){for(var e=[],i=0,o=t.length;i<o;i++){var n=t[i];n.isIgnored||e.push(n)}return e},o.prototype._packItem=function(t){this._setRectSize(t.element,t.rect),this.packer.pack(t.rect,this.options.layoutMode),"horizontal"==this.options.layoutMode?this._setMaxX(t.rect):this._setMaxY(t.rect)},o.prototype._setMaxX=function(t){this.maxX=Math.max(t.x+t.width,this.maxX)},o.prototype._setMaxY=function(t){this.maxY=Math.max(t.y+t.height,this.maxY)},o.prototype._setRectSize=function(t,e){var i=p(t),o=i.outerWidth,i=i.outerHeight,n=this.columnWidth+this.gutter,r=this.rowHeight+this.gutter,o=this.columnWidth?Math.ceil(o/n)*n:o+this.gutter,i=this.rowHeight?Math.ceil(i/r)*r:i+this.gutter;"horizontal"==this.options.layoutMode?(e.width=o,e.height=Math.min(i,this.packer.height)):(e.width=Math.min(o,this.packer.width),e.height=i)},o.prototype._layoutItem=function(t,e){var i=t.rect;e?t.goTo(i.x,i.y):t.moveTo(i.x,i.y)},o.prototype._itemsOn=function(t,e,i){function o(){return n++,n===r&&i.call(s),!0}for(var n=0,r=t.length,s=this,a=0,h=t.length;a<h;a++)t[a].on(e,o)},o.prototype.stamp=function(t){if(t){"string"==typeof t&&(t=this.element.querySelectorAll(t)),t=i(t),this.stampedElements.push.apply(this.stampedElements,t);for(var e=0,o=t.length;e<o;e++)this.ignore(t[e])}},o.prototype.unstamp=function(t){if(t){t=i(t);for(var e=0,o=t.length;e<o;e++){var n=t[e],r=g(this.stampedElements,n);-1!==r&&this.stampedElements.splice(r,1),this.unignore(n)}}},o.prototype.placeStampedElements=function(){if(this.stampedElements&&this.stampedElements.length){this._getBounds();for(var t=0,e=this.stampedElements.length;t<e;t++)this.placeStamp(this.stampedElements[t])}},o.prototype._getBounds=function(){var t=this.element.getBoundingClientRect();this._boundingLeft=t.left+this.elementSize.paddingLeft,this._boundingTop=t.top+this.elementSize.paddingTop},o.prototype.placeStamp=function(t){var e,i=this.getItem(t);e=i&&i.isPlacing?i.placeRect:this._getElementOffsetRect(t),this._setRectSize(t,e),this.packer.placed(e,this.options.layoutMode),"horizontal"==this.options.layoutMode?this._setMaxX(i.rect):this._setMaxY(i.rect)},o.prototype._getElementOffsetRect=function(t){return t=t.getBoundingClientRect(),t=new r({x:t.left-this._boundingLeft,y:t.top-this._boundingTop}),t.x-=this.elementSize.borderLeftWidth,t.y-=this.elementSize.borderTopWidth,t},o.prototype.handleEvent=function(t){var e="on"+t.type;this[e]&&this[e](t)},o.prototype.bindResize=function(){this.isResizeBound||(l.bind(t,"resize",this),this.isResizeBound=!0)},o.prototype.unbindResize=function(){l.unbind(t,"resize",this),this.isResizeBound=!1},o.prototype.onresize=function(){this.resizeTimeout&&clearTimeout(this.resizeTimeout);var t=this;this.resizeTimeout=setTimeout(function(){t.resize()},100)},o.prototype.resize=function(){var t=p(this.element);this.elementSize&&t&&t.innerWidth===this.elementSize.innerWidth||(this.layout(),delete this.resizeTimeout)},o.prototype.addItems=function(t){if(t=this._getItems(t),t.length)return this.items.push.apply(this.items,t),t},o.prototype.appended=function(t){t=this.addItems(t),t.length&&(this.layoutItems(t,!0),this.reveal(t))},o.prototype.prepended=function(t){if(t=this._getItems(t),t.length){var e=this.items.slice(0);this.items=t.concat(e),this._prelayout(),this.layoutItems(t,!0),this.reveal(t),this.layoutItems(e)}},o.prototype.reveal=function(t){if(t&&t.length)for(var e=0,i=t.length;e<i;e++)t[e].reveal()},o.prototype.getItem=function(t){for(var e=0,i=this.items.length;e<i;e++){var o=this.items[e];if(o.element===t)return o}},o.prototype.getItems=function(t){if(t&&t.length){for(var e=[],i=0,o=t.length;i<o;i++){var n=this.getItem(t[i]);n&&e.push(n)}return e}},o.prototype.remove=function(t){t=i(t);var e=this.getItems(t);this._itemsOn(e,"remove",function(){this.emitEvent("removeComplete",[this,e])}),t=0;for(var o=e.length;t<o;t++){var n=e[t];n.remove(),n=g(this.items,n),this.items.splice(n,1)}},o.prototype.ignore=function(t){(t=this.getItem(t))&&(t.isIgnored=!0)},o.prototype.unignore=function(t){(t=this.getItem(t))&&delete t.isIgnored},o.prototype.sortItemsByPosition=function(){this.items.sort(function(t,e){return t.position.y-e.position.y||t.position.x-e.position.x})},o.prototype.fit=function(t,e,i){function o(){2===++s&&r.emitEvent("fitComplete",[r,n])}var n=this.getItem(t);if(n){this._getMeasurements(),this.stamp(n.element),n.getSize(),n.isPlacing=!0,e=void 0===e?n.rect.x:e,i=void 0===i?n.rect.y:i,n.positionPlaceRect(e,i,!0);var r=this,s=0;n.on("layout",function(){return o(),!0}),this.on("layoutComplete",function(){return o(),!0}),n.moveTo(n.placeRect.x,n.placeRect.y),this.layout(),this.unstamp(n.element),this.sortItemsByPosition(),n.isPlacing=!1,n.copyPlaceRectPosition()}},o.prototype.itemDragStart=function(t){this.stamp(t),(t=this.getItem(t))&&t.dragStart()},o.prototype.itemDragMove=function(t,e,i){(t=this.getItem(t))&&t.dragMove(e,i);var o=this;this.clearDragTimeout(),this.dragTimeout=setTimeout(function(){o.layout(),delete o.dragTimeout},40)},o.prototype.clearDragTimeout=function(){this.dragTimeout&&clearTimeout(this.dragTimeout)},o.prototype.itemDragEnd=function(t){function e(){return++s!==r||(o&&(h.remove(o.element,"is-positioning-post-drag"),o.isPlacing=!1,o.copyPlaceRectPosition()),a.unstamp(t),a.sortItemsByPosition(),o&&n&&a.emitEvent("dragItemPositioned",[a,o]),!0)}var i,o=this.getItem(t);if(o&&(i=o.didDrag,o.dragStop()),o&&(i||o.needsPositioning)){h.add(o.element,"is-positioning-post-drag");var n=o.needsPositioning,r=n?2:1,s=0,a=this;n?(o.on("layout",e),o.moveTo(o.placeRect.x,o.placeRect.y)):o&&o.copyPlaceRectPosition(),this.clearDragTimeout(),this.on("layoutComplete",e),this.layout()}else this.unstamp(t)},o.prototype.bindDraggabillyEvents=function(t){t.on("dragStart",this.handleDraggabilly.dragStart),t.on("dragMove",this.handleDraggabilly.dragMove),t.on("dragEnd",this.handleDraggabilly.dragEnd)},o.prototype.bindUIDraggableEvents=function(t){t.on("dragstart",this.handleUIDraggable.start).on("drag",this.handleUIDraggable.drag).on("dragstop",this.handleUIDraggable.stop)},o.prototype.destroy=function(){this.element.style.position="",this.element.style.height="",delete this.element.packeryGUID;for(var t=0,e=this.items.length;t<e;t++)this.items[t].destroy();this.unbindResize()},o.data=function(t){return(t=t.packeryGUID)&&v[t]},n(function(){for(var t=c.querySelectorAll(".js-packery"),e=0,i=t.length;e<i;e++){var n,r=t[e],s=r.getAttribute("data-packery-options");try{n=s&&JSON.parse(s)}catch(t){u&&u.error("Error parsing data-packery-options on "+r.nodeName.toLowerCase()+(r.id?"#"+r.id:"")+": "+t);continue}s=new o(r,n),f&&f.data(r,"packery",s)}}),f&&f.bridget&&f.bridget("packery",o),o.Rect=r,o.Packer=s,o.Item=a,t.Packery=o}(window);var CollageController=function(t,e){var i=this;i.itemClass="item",i.itemSelector="."+i.itemClass,i.items=[],i.props={},utils.capabilities.mask(),this.resize=_.debounce(_.bind(this._resize,this),200),CollageController.super_.apply(this,arguments),$(this.el).on("click","."+this.itemClass,function(t){var e=$(t.currentTarget).index();i.itemClick(i.items[e],e,t)}),i.viewportOriginalHeight=i.getViewportSize().height};utils.inherits(CollageController,SimpleAppProto),CollageController.prototype.changeEditMode=function(){"editor"!==this.editMode&&$(".details").fadeOut().addClass("hide")},CollageController.prototype.itemClick=function(t,e,i){var o=this;switch(o.props.galleryImageOnClickAction){case"goToLink":o.openLink(t.href,t.target,t.linkType,i,t["data-anchor"],o.mainPageId,t.link);break;case"zoomMode":Wix.pushState(JSON.stringify({cmd:"zoom",args:[e]}));break;case"disabled":default:Wix.pushState(JSON.stringify({cmd:"itemClicked",args:[e]}))}},CollageController.prototype.createDom=function(){var t=this,e=t.getViewportSize(),i=t.props.numOfCells;t.el.html(""),t.displayNode=$('<div id="packery"></div>').appendTo(this.el);var o={timer:0,direction:"+",start:function(e){e&&e.target&&($(this).is(".prev")||$(this).is(".alternativePrev")?o.direction="-":o.direction="+"),o.stop(),t.el.stop().animate({scrollLeft:o.direction+"="+Math.floor(.2*t.el.width())+"px"},1e3,"linear"),o.timer=setTimeout(o.start,900)},stop:function(){t.el.stop(),clearTimeout(o.timer)}};$('<div><div class="inner"></div></div>').appendTo(t.el).addClass("prev").hover(o.start,o.stop).hide().click(function(){o.stop(),t.el.animate({scrollLeft:"-="+Math.floor(.5*t.el.width())+"px"},500,"easeOutSine",function(){o.start()})}).hide(),$('<div><div class="inner"></div></div>').appendTo(t.el).addClass("next").hover(o.start,o.stop).hide().click(function(){o.stop(),t.el.animate({scrollLeft:"+="+Math.floor(.5*t.el.width())+"px"},500,"easeOutSine",function(){o.start()})}).hide(),$('<div class="alternativePrev"></div>').appendTo(t.el).hover(o.start,o.stop),$('<div class="alternativeNext"></div>').appendTo(t.el).hover(o.start,o.stop);_.each(this.items,function(e,i){itemNode=$("<div></div>").appendTo(t.displayNode),itemNode.data("item",e).addClass(t.itemClass),$("<div></div>").appendTo(itemNode).addClass("filler");var o=$("<div></div>").appendTo(itemNode).addClass("details");$("<div></div>").appendTo(itemNode).addClass("overlay"),$("<h3></h3>").appendTo(o).addClass("title").html(e.title),$("<div></div>").appendTo(o).addClass("desc").html(e.description)});var n={itemSelector:t.itemSelector,containerStyle:{position:"relative",height:e.height+"px"}};if("horizontal"==t.props.orientation?(t.cellDimension=Math.floor(e.height/i),n.layoutMode="horizontal"):(t.cellDimension=Math.floor(e.width/i),n.layoutMode="vertical"),t.isMobile){var r=0;$(".details").addClass("hide"),t.displayNode.hammer({stop_browser_behavior:{userSelect:"none",touchAction:"auto",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}}).on("dragstart",function(e){if("horizontal"==t.props.orientation)return r=t.el[0].scrollLeft,e.gesture.preventDefault(),e.preventDefault(),!1}).on("drag",function(e){var i=e.gesture;if("horizontal"==t.props.orientation)return t.el[0].scrollLeft=r-Math.floor(1.7*i.deltaX),e.gesture.preventDefault(),!1})}t.pckry=new Packery(t.displayNode[0],n)},CollageController.prototype.updateLayout=function(){var t=this,e=t.getViewportSize(),i=t.distributeCellSizes(),o=$("#packery"),n="disabled"===t.props.galleryImageOnClickAction,r="goToLink"===t.props.galleryImageOnClickAction,s="zoomMode"===t.props.galleryImageOnClickAction;if("horizontal"==t.props.orientation&&t.prevOrientation!=t.props.orientation&&(e.height=t.viewportOriginalHeight,t.el.height(e.height),Wix.setHeight(e.height)),"site"==t.editMode&&$(".details").fadeOut().addClass("hide"),$(".next,.prev").css("background-color","white").find(".inner").css("background-color","black"),$(t.itemSelector,t.el).each(function(e){var o=$(this),n=o.data("item"),a=i[e],h=t.getSizeInCells(n,a),l="horizontal"==t.props.orientation?t.cellDimension*h.height:Math.floor(3*t.cellDimension/4)*h.height,p="horizontal"==t.props.orientation?Math.floor(4*t.cellDimension/3)*h.width:t.cellDimension*h.width,d=utils.getResizedImageUrl(n.uri,p,l,{maxWidth:n.width,maxHeight:n.height,siteQuality:t.quality}),c=(n.width,n.height,Math.floor((l-$(".title",o).height()-$(".desc",o).height())/2)),u=t.getTextSizeInCell(p);switch(u.titleSize?$(".title",o).html(n.title).css("font-size",u.titleSize+"px"):$(".title",o).html(""),u.descSize?$(".desc",o).html(n.description).css("font-size",u.descSize+"px"):$(".desc",o).html(""),t.props.textMode){case"titleAndDescription":c=p<170||!n.description?Math.floor((l-35)/2):Math.floor((l-60)/2);break;case"titleOnly":c=Math.floor((l-35)/2)}u.titleSize&&!u.descSize&&(c=Math.floor((l-35)/2)),o.height(l).width(p);var f=Math.floor(t.props.margin/2)+"px",m=Math.floor(t.props.margin/2)+26+"px";s||r&&_.isEmpty(n.href);$(".filler",o).css({backgroundImage:"url("+d+")",backgroundSize:"cover",top:f,left:f,right:f,bottom:f}),$(".details",o).css({left:m,right:m,top:c}),$(".overlay",o).css({top:f,left:f,right:f,bottom:f,display:"block"});var g;o.hover(function(){switch(clearTimeout(g),t.props.textMode){case"titleAndDescription":p<170?($(".title,.details",o).removeClass("hide").fadeIn(1e3),$(".desc",o).addClass("hide")):$(".title,.desc,.details",o).removeClass("hide").fadeIn(1e3);break;case"titleOnly":$(".title,.details",o).removeClass("hide").fadeIn(1e3),$(".desc",o).addClass("hide");break;case"noText":$(".title,.desc,.details",o).addClass("hide")}},function(){$(".details",o).stop().fadeOut(1e3),g=setTimeout(function(){$(".details",o).addClass("hide")},1e3)})}),"editor"==$("#viewport").attr("data-mode"))switch(t.props.textMode){case"titleAndDescription":$(".title,.desc,.details").removeClass("hide");break;case"titleOnly":$(".title,.details").removeClass("hide"),$(".desc").addClass("hide");break;case"noText":$(".title,.desc,.details").addClass("hide")}if($("."+this.itemClass,this.el).each(function(){var t=$(this).data("item");if(t){$(".overlay",this).show(),n||r&&_.isEmpty(t.href)?$(this).css("cursor",""):$(this).css("cursor","pointer")}}),this.props.backgroundMouseoverColor){var a="#viewport "+t.itemSelector+":hover .overlay",h=this.props.backgroundMouseoverColor;void 0!==this.props.alphaBackgroundMouseoverColor&&$.support.opacity&&(h=utils.hexToRgba(this.props.backgroundMouseoverColor,this.props.alphaBackgroundMouseoverColor));var l=utils.insertCssRule(t,a+" { background-color: "+h+"!important; }");l.style.backgroundColor=h,$.support.opacity||(l.style["-ms-filter"]="progid:DXImageTransform.Microsoft.Alpha(Opacity=50)",l.style.filter="alpha(opacity=50)",l.style.opacity=.5)}t.pckry.layout(),!0===t.props.showNavButtons&&"horizontal"==t.props.orientation&&o.width()>t.el.width()&&!t.isMobile?(t.el.find(".prev, .next").show(),t.el.find(".alternativePrev, .alternativeNext").hide()):!1===t.props.showNavButtons&&"horizontal"==t.props.orientation&&o.width()>t.el.width()&&!t.isMobile?(t.el.find(".prev,.next").hide(),
t.el.find(".alternativePrev, .alternativeNext").show()):t.el.find(".prev,.next,.alternativePrev,.alternativeNext").hide(),"vertical"==t.props.orientation&&Wix.setHeight(t.displayNode.height())},CollageController.prototype.distributeCellSizes=function(){var t=this,e=[],i=t.items.length;Math.seedrandom("layout-seed-"+t.props.layoutSeed);for(var o=0;o<i;o++){var n=t.props.minImageSize,r=t.props.maxImageSize,s=Math.floor((r+n)/2);if(Math.random()<.8)var a=Math.floor(Math.random()*(s-n+1))+n;else var a=Math.ceil(Math.random()*(r-s))+s;e.push(a)}return e},CollageController.prototype.updateSettings=function(t){var e=this,i=!1;e.mainPageId=t.mainPageId,e.quality=t.quality||{},e.itemsChanged(t.items,["uri"])?i=!0:e.propsChanged(t.props,["minImageSize","maxImageSize","avergeImageSize","numOfCells","orientation","layoutSeed"])&&(i=!0),e.propsChanged(t.props,["textMode"])&&$(e.itemSelector,e.el).find(".details").removeClass("hide"),e.prevOrientation=e.props.orientation,i?(e.destroy(),e.items=t.items||[],e.props=t.props||{},e.createDom()):_.extend(e.props,t.props),$(e.el).css("text-align",e.props.alignText),e.isMobile&&(e.props.textMode="noText"),utils.loadGoogleFontIfNeeded(this.props.font),$(e.itemSelector,e.el).find(".title").css({fontFamily:utils.fontFamilyDegradation(e.props.font),color:utils.hexToRgba(e.props.textColor,e.props.alphaTextColor)}),$(e.itemSelector,e.el).find(".desc").css({fontFamily:utils.fontFamilyDegradation(e.props.font),color:utils.hexToRgba(e.props.descriptionColor,e.props.alphaDescriptionColor)}),e.updateLayout()},CollageController.prototype.destroy=function(){this.el.html("")},CollageController.prototype._resize=function(){var t=this,e=t.getViewportSize(),i=t.props.numOfCells;"horizontal"==t.props.orientation?(t.viewportOriginalHeight=e.height,t.el.height(t.viewportOriginalHeight)):t.el.height("auto");var o={itemSelector:t.itemSelector,containerStyle:{position:"relative",height:e.height+"px",width:e.width+"px"}};"horizontal"==t.props.orientation?(t.cellDimension=Math.floor(e.height/i),o.layoutMode="horizontal"):(t.cellDimension=Math.floor(e.width/i),o.layoutMode="vertical"),Wix.setHeight(t.el.height()),t.pckry.destroy(),t.pckry=new Packery(t.displayNode[0],o),t.updateLayout()},CollageController.prototype.getViewportSize=function(){var t=document.documentElement;return{width:t.clientWidth,height:t.clientHeight}},CollageController.prototype.getTextSizeInCell=function(t){var e=null,i=null;return t<170||(t<240?e=21:t<420?(e=24,i=15):t<580?(e=30,i=15):t<650?(e=38,i=21):(e=48,i=24)),{titleSize:e,descSize:i}},CollageController.prototype.getSizeInCells=function(t,e){var i=this,o=t.width/t.height,n={width:1,height:1};return"horizontal"==i.props.orientation?(n.width=e,n.height=o<=2?e:Math.min(e,Math.ceil(e/o*4/3))):(n.height=e,n.width=o<=2?Math.min(e,Math.max(1,Math.floor(e*o*3/4))):e),n};